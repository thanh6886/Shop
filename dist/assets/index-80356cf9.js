import{n as U,q as Y,_ as Q,s as T,t as H,v as J,r as h,j as r,A as V,m as K,b as M,a as W,w as X,Q as S,i as Z,C as A,x as ee,o as re,y as te}from"./index-187f8b77.js";import{u as y}from"./user.api-638dc0ef.js";import{B as se}from"./Button-816b9e9d.js";import{I as R}from"./Input-f6eb5d68.js";import{I as ae}from"./InputNumber-6393f7be.js";var ne=Math.ceil,ie=Math.max;function oe(e,t,a,n){for(var d=-1,l=ie(ne((t-e)/(a||1)),0),s=Array(l);l--;)s[n?l:++d]=e,e+=a;return s}var ce=oe,de=U,le=Y,me=Q,he=T;function xe(e,t,a){if(!he(a))return!1;var n=typeof t;return(n=="number"?le(a)&&me(t,a.length):n=="string"&&t in a)?de(a[t],e):!1}var fe=xe,pe=/\s/;function ge(e){for(var t=e.length;t--&&pe.test(e.charAt(t)););return t}var ue=ge,be=ue,je=/^\s+/;function we(e){return e&&e.slice(0,be(e)+1).replace(je,"")}var ye=we,Ne=ye,D=T,ve=H,$=0/0,_e=/^[-+]0x[0-9a-f]+$/i,Ie=/^0b[01]+$/i,Ce=/^0o[0-7]+$/i,Ee=parseInt;function Fe(e){if(typeof e=="number")return e;if(ve(e))return $;if(D(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=D(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Ne(e);var a=Ie.test(e);return a||Ce.test(e)?Ee(e.slice(2),a?2:8):_e.test(e)?$:+e}var Me=Fe,Se=Me,P=1/0,Ae=17976931348623157e292;function Re(e){if(!e)return e===0?e:0;if(e=Se(e),e===P||e===-P){var t=e<0?-1:1;return t*Ae}return e===e?e:0}var De=Re,$e=ce,Pe=fe,N=De;function Te(e){return function(t,a,n){return n&&typeof n!="number"&&Pe(t,a,n)&&(a=n=void 0),t=N(t),a===void 0?(a=t,t=0):a=N(a),n=n===void 0?t<a?1:-1:N(n),$e(t,a,n,e)}}var ke=Te,Oe=ke,ze=Oe(),Be=ze;const v=J(Be);function Le({value:e,onChange:t,errorMessage:a}){const[n,d]=h.useState({date:(e==null?void 0:e.getDate())||1,month:(e==null?void 0:e.getMonth())||0,year:(e==null?void 0:e.getFullYear())||1990});h.useEffect(()=>{e&&d({date:e.getDate(),month:e.getMonth(),year:e.getFullYear()})},[e]);const l=s=>{const{value:b,name:j}=s.target,x={...n,[j]:b};d(x),t&&t(new Date(x.year,x.month,x.date))};return r.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[r.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Ngày sinh"}),r.jsxs("div",{className:"sm:w-[80%] sm:pl-5",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsxs("select",{onChange:l,name:"date",className:"h-10 w-[32%] cursor-pointer rounded-sm border border-black/10 px-3 hover:border-orange",value:(e==null?void 0:e.getDate())||n.date,children:[r.jsx("option",{disabled:!0,children:"Ngày"}),v(1,32).map(s=>r.jsx("option",{value:s,children:s},s))]}),r.jsxs("select",{onChange:l,name:"month",className:"h-10 w-[32%] cursor-pointer rounded-sm border border-black/10 px-3 hover:border-orange",value:(e==null?void 0:e.getMonth())||n.month,children:[r.jsx("option",{disabled:!0,children:"Tháng"}),v(0,12).map(s=>r.jsx("option",{value:s,children:s+1},s))]}),r.jsxs("select",{onChange:l,name:"year",className:"h-10 w-[32%] cursor-pointer rounded-sm border border-black/10 px-3 hover:border-orange",value:(e==null?void 0:e.getFullYear())||n.year,children:[r.jsx("option",{disabled:!0,children:"Năm"}),v(1990,2025).map(s=>r.jsx("option",{value:s,children:s},s))]})]}),r.jsx("div",{className:"mt-1 min-h-[1.25rem] text-sm text-red-600",children:a})]})]})}function Je(){var E,F;const{setProfile:e}=h.useContext(V),[t,a]=h.useState(),n=h.useMemo(()=>t?URL.createObjectURL(t):"",[t]),{data:d,refetch:l}=K({queryKey:["profile"],queryFn:y.getProfile}),s=d==null?void 0:d.data.data,b=M({mutationFn:i=>y.updateProfile(i)}),j=M({mutationFn:y.uploadAvatar}),x=W({defaultValues:{name:"",phone:"",address:"",avatar:"",date_of_birth:new Date(1990,0,1)},resolver:re(te)}),{register:_,control:I,formState:{errors:u},handleSubmit:k,setValue:m,watch:O,setError:z}=x,C=O("avatar");h.useEffect(()=>{s&&(m("name",s.name||""),m("phone",s.phone||""),m("address",s.address||""),m("avatar",s.avatar||""),m("date_of_birth",s.date_of_birth?new Date(s.date_of_birth):new Date(1990,0,1)))},[s,m]);const B=k(async i=>{var o,p;try{let c=C;if(t){const g=new FormData;g.append("image",t),c=(await j.mutateAsync(g)).data.data,m("avatar",c)}const f=await b.mutateAsync({...i,date_of_birth:(o=i.date_of_birth)==null?void 0:o.toISOString(),avatar:c});e(f.data.data),X(f.data.data),S.success("cập nhật thông tin thành công",{autoClose:600})}catch(c){if(Z(c)){const f=(p=c.response)==null?void 0:p.data.data;f&&Object.keys(f).forEach(g=>{z(g,{message:f[g],type:"Server"})})}}}),L=i=>{a(i)},w=h.useRef(null),q=i=>{var p,c;const o=(p=i.target.files)==null?void 0:p[0];(c=w.current)==null||c.setAttribute("value",""),o&&(o.size>=1048576||!o.type.includes("image"))?S.error("Dụng lượng file tối đa 1 MB. Định dạng:.JPEG, .PNG",{position:"top-center"}):L(o)},G=()=>{var i;(i=w.current)==null||i.click()};return r.jsxs("div",{className:"rounded-sm bg-white px-2 pb-10 shadow md:px-7 md:pb-20",children:[r.jsxs("div",{className:"border-b border-b-gray-200 py-6",children:[r.jsx("h1",{className:"text-lg font-medium capitalize text-gray-900",children:"Hồ Sơ Của Tôi"}),r.jsx("div",{className:"mt-1 text-sm text-gray-700",children:"Quản lý thông tin hồ sơ để bảo mật tài khoản"})]}),r.jsxs("form",{className:"mt-8 flex flex-col-reverse md:flex-row md:items-start",onSubmit:B,children:[r.jsxs("div",{className:"mt-6 flex-grow md:mt-0 md:pr-12",children:[r.jsxs("div",{className:"flex flex-col flex-wrap sm:flex-row",children:[r.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Email"}),r.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:r.jsx("div",{className:"pt-3 text-gray-700",children:s==null?void 0:s.email})})]}),r.jsxs("div",{className:"mt-6 flex flex-col flex-wrap sm:flex-row",children:[r.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Tên"}),r.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:r.jsx(R,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",register:_,name:"name",placeholder:"Tên",errorMessage:(E=u.name)==null?void 0:E.message})})]}),r.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[r.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Số điện thoại"}),r.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:r.jsx(A,{control:I,name:"phone",render:({field:i})=>{var o;return r.jsx(ae,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",placeholder:"Số điện thoại",errorMessage:(o=u.phone)==null?void 0:o.message,...i,onChange:i.onChange})}})})]}),r.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[r.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right",children:"Địa chỉ"}),r.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:r.jsx(R,{classNameInput:"w-full rounded-sm border border-gray-300 px-3 py-2 outline-none focus:border-gray-500 focus:shadow-sm",register:_,name:"address",placeholder:"Địa chỉ",errorMessage:(F=u.address)==null?void 0:F.message})})]}),r.jsx(A,{control:I,name:"date_of_birth",render:({field:i})=>{var o;return r.jsx(Le,{errorMessage:(o=u.date_of_birth)==null?void 0:o.message,value:i.value,onChange:i.onChange})}}),r.jsxs("div",{className:"mt-2 flex flex-col flex-wrap sm:flex-row",children:[r.jsx("div",{className:"truncate pt-3 capitalize sm:w-[20%] sm:text-right"}),r.jsx("div",{className:"sm:w-[80%] sm:pl-5",children:r.jsx(se,{className:"flex h-9 items-center rounded-sm bg-orange px-5 text-center text-sm text-white hover:bg-orange/80",type:"submit",children:"Lưu"})})]})]}),r.jsx("div",{className:"flex justify-center md:w-72 md:border-l md:border-l-gray-200",children:r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx("div",{className:"my-5 h-24 w-24",children:r.jsx("img",{src:n||ee(C),alt:"",className:"h-full w-full rounded-full object-cover"})}),r.jsx("input",{className:"hidden",type:"file",accept:".jpg,.jpeg,.png",ref:w,onChange:q,onClick:i=>{i.target.value=null}}),r.jsx("button",{className:"flex h-10 items-center justify-end rounded-sm border bg-white px-6 text-sm text-gray-600 shadow-sm",type:"button",onClick:G,children:"Chọn ảnh"}),r.jsxs("div",{className:"mt-3 text-gray-400",children:[r.jsx("div",{children:"Dụng lượng file tối đa 1 MB"}),r.jsx("div",{children:"Định dạng:.JPEG, .PNG"})]})]})})]})]})}export{Je as default};
